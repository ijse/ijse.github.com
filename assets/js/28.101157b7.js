(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{325:function(t,s,n){"use strict";n.r(s);var a=n(25),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("有关Electron 打包，网上有很多文章，但一些已经过时，并不适用于最新的版本，在研究的时候因此而走了一些弯路。")]),t._v(" "),n("p",[t._v("截止本文，我使用的相关版本是：\n"),n("ul",[n("li",[t._v("electron v1.6.4")]),t._v(" "),n("li",[t._v("electron-builder v16.4.1")])]),t._v("\n大家可以根据情况阅读本文。")]),t._v(" "),n("h3",[t._v("两种主流的打包工具")]),t._v("\n官方文档中两种主要工具是electron-packager和electron-builder，区别主要是：\n"),n("ul",[n("li",[t._v("electron-packager主要是程序打包，并不包含生成Installer，且不能在Mac下打包Win程序")]),t._v(" "),n("li",[t._v("electron-builder是包含了electron-packager，能够生成Installer，并且可以在Mac平台下打包Mac, Linux和Windows包")])]),t._v("\nelectron-builder工具功能更强大，不仅支持打包，生成Installer，而且还可以发布到GitHub或S3等平台，且支持自动更新。\n"),n("h3",[t._v("electron-builder的文档")]),t._v("\n文档地址：[link](https://github.com/electron-userland/electron-builder/wiki)\n"),n("p",[t._v("electron-builder代码提交很活跃，更新较频繁，文档也同样😔。")]),t._v(" "),n("p",[t._v("吐槽一下它的"),n("a",{attrs:{href:"https://github.com/electron-userland/electron-builder/wiki/Options",target:"_blank",rel:"noopener noreferrer"}},[t._v("Options"),n("OutboundLink")],1),t._v("文档，后半部分貌似是从代码注释中自动生成的文档，是根据代码类名排序的内容，而不是一般的理解和配置顺序，查看时候需要关注其配置项的名称和继承关系，并且有些链接是坏的。")]),t._v(" "),n("p",[t._v("它提供了两种配置方式，这里主要介绍通过"),n("code",[t._v("package.json这种方式。")])]),t._v(" "),n("p",[t._v("建议阅读的顺序是：\n"),n("ol",[n("li",[n("a",{attrs:{href:"https://github.com/electron-userland/electron-builder/blob/master/docs/Options.md#Metadata",target:"_blank",rel:"noopener noreferrer"}},[t._v("Metadata"),n("OutboundLink")],1),t._v(" 这部分写的是Package.json中的配置项")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/electron-userland/electron-builder/blob/master/docs/Options.md#config--platformspecificbuildoptions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Config"),n("OutboundLink")],1),t._v(" 这是在package.json#build中的配置")])]),t._v("\n在阅读文档时，注意Type一栏列出的链接，然后再搜索找到相应的详细配置部分。（有的可能不在本页面内，可以在源码"),n("code",[t._v("packages/目录")]),t._v("中寻找）\n")]),n("h3",[t._v("OSX Signing")]),t._v("\nApp的分发有两种形式：.app及 MAS。"),n("p"),t._v(" "),n("p",[t._v("app不签名默认是无法运行的。")]),t._v(" "),n("p",[t._v("我们需要购买一个Apple开发者账号，并本地生成一个密钥，然后导入证书。\n")]),n("blockquote",[t._v("refer："),n("a",{attrs:{href:"https://github.com/nwjs/nw.js/wiki/MAS%3A-Requesting-certificates",target:"_blank",rel:"noopener noreferrer"}},[t._v("link"),n("OutboundLink")],1)]),t._v("\n对于其它开发者，可以通过导出并分享.p12文件添加。\n"),n("h3",[t._v("Windows Signing")]),n("p"),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('➜  my-app git:(master) ✗ makecert -sv my_win_private_key.pvk -n "CN=MyWinCertificate" -b 01/01/2017 -e 01/01/2027 -r my_win_certificate.cer\nMono MakeCert - version 4.6.2.0\nX.509 Certificate Builder\nCopyright 2002, 2003 Motus Technologies. Copyright 2004-2008 Novell. BSD licensed.\n\nSuccess\n\n➜  my-app git:(master) ✗ pvk2pfx -pvk my_win_private_key.pvk -spc my_win_certificate.cer -pfx my_signing_key.pfx -po my_password\n')])])]),n("blockquote",[t._v("refer: [link](https://www.npmjs.com/package/electron-installer-windows#signing)")]),t._v("\n默认Mac下安装mono后，应该会有"),n("code",[t._v("makecert")]),t._v("和"),n("code",[t._v("pvk2pfx")]),t._v("这两个工具。如果没有，可以到Win下进行签名，或者直接从网上下载。\n"),n("h3",[t._v("有关自动更新")]),t._v("\nelectron-builder的自动更新机制依赖的是Squirrel.Mac和Squirrel.windows，并且最新版本已经可以实现不需要准备一台接口服务器，只需要静态服务器便可实现。\n"),n("blockquote",[t._v("Refer: [link](https://github.com/electron-userland/electron-builder/blob/master/docs/Auto%20Update.md)")]),t._v("\n一般，用S3是比较省心的，按照文档配置就可以实现Win和Mac双平台的自动更新，只需要代码响应相应事件即可。\n"),n("p",[t._v("但我们所使用的是GitHub Private Repo，有鉴权的问题。采用的解决方案是Nuts + GitHub， Nuts作为更新接口，GitHub提供存储。")]),t._v(" "),n("p",[t._v("相关配置如下：")]),t._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"publish"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"provider"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"generic"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://down.ijser.cn/download"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"provider"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"owner"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ijse"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"repo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"desktop-app"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("p",[t._v("自动静默后台更新实现：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" log "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" os "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dialog "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'electron'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" autoUpdater "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'electron-updater'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autoUpdater\n\nautoUpdater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" log\nautoUpdater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("level "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'info'")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    autoUpdater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkForUpdates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    autoUpdater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update-downloaded'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dialog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("showMessageBox")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$mainWindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'question'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        buttons"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'重启并使用新版本'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'下次打开时升级'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        defaultId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cancelId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'新版本已经准备好了'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'马上重启并使用新版本吗？'")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        autoUpdater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("quitAndInstall")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",[t._v("调试打包过程")]),t._v("\nelectron-builder遵循惯用的调试日志方式：\n"),n("pre",{staticClass:"lang:default decode:true "},[t._v("NODE_ENV=electron-builder build")]),t._v("\n这样执行打包过程后，会输出详细的过程日志，对调试很有帮助。\n"),n("h3",[t._v("最后")]),t._v("\nelectron-builder 因为文档有点不太完美，实际学习起来会有点吃力，遇到文档不能很好解决的问题，可以去查Issues 和 代码，另外，关注Releases最新版本和发版说明。\n")])},[],!1,null,null,null);s.default=e.exports}}]);
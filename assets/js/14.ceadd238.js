(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{330:function(e,t,r){"use strict";r.r(t);var a=r(24),d=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("Raspberry Pi 默认是没有RTC的，系统设置的时间在断电后便会丢失，再次开机时又会回到1970年。通常让RPI保存时间的办法有两个：")]),e._v(" "),r("ul",[r("li",[e._v("网络时间同步，用NTP")]),e._v(" "),r("li",[e._v("添加RTC硬件模块")])]),e._v(" "),r("p",[e._v("RTC模块跟PC主板上的一样，我们可以把它插到Raspberry Pi的GPIO接口上，然后需要进行一番配置；")]),e._v(" "),r("h3",{attrs:{id:"第一步，添加初始化rtc模块调用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第一步，添加初始化rtc模块调用","aria-hidden":"true"}},[e._v("#")]),e._v(" 第一步，添加初始化rtc模块调用")]),e._v(" "),r("p",[e._v("修改"),r("code",[e._v("/etc/init.d/hwclock.sh")]),e._v("头文件，添加如下Shell代码：")]),e._v(" "),r("pre",[r("code",[e._v('init_rtc_device() {\n  [ -e /dev/rtc0 ] && return 0;\n  #load i2c and RTC kernel modules\n  modprobe i2c-dev\n  modprobe rtc-ds1307\n\n  #iterate over every i2c bus as we\'re supporting Raspberry Pi rev. 1 and 2\n  #(different I2C busses on GPIO header!)\n  for bus in $(ls -d /sys/bus/i2c/devices/i2c-*);\n  do\n     echo ds1307 0x68 >> $bus/new_device;\n     if [ -e /dev/rtc0 ]; then\n       log_action_msg "RTC found on bus `cat $bus/name`";\n       break; # RTC found, bail out of the loop\n     else\n       echo 0x68 >> $bus/delete_device\n     fi\n   done\n}\ninit_rtc_device\n')])]),e._v(" "),r("h3",{attrs:{id:"第二步，开启"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第二步，开启","aria-hidden":"true"}},[e._v("#")]),e._v(" 第二步，开启")]),e._v(" "),r("p",[e._v("修改"),r("code",[e._v("/etc/modprobe.d/raspi-blacklist.conf")]),e._v("配置文件，把第二行注释掉：")]),e._v(" "),r("pre",[r("code",[e._v("#blacklist i2c-bcm2708\n")])]),e._v(" "),r("h3",{attrs:{id:"第三步，更新启动配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第三步，更新启动配置","aria-hidden":"true"}},[e._v("#")]),e._v(" 第三步，更新启动配置")]),e._v(" "),r("pre",[r("code",[e._v("sudo update-rc.d hwclock.sh enable\n")])]),e._v(" "),r("p",[e._v("然后重启下：")]),e._v(" "),r("pre",[r("code",[e._v("sudo reboot\n")])]),e._v(" "),r("h3",{attrs:{id:"第四步，设置本地时区"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第四步，设置本地时区","aria-hidden":"true"}},[e._v("#")]),e._v(" 第四步，设置本地时区")]),e._v(" "),r("p",[e._v("可以进入"),r("code",[e._v("sudo raspi-config")]),e._v("工具，也可以直接使用命令：")]),e._v(" "),r("pre",[r("code",[e._v("sudo dpkg-reconfigure tzdata\n")])]),e._v(" "),r("h3",{attrs:{id:"第五步，关掉一些默认配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第五步，关掉一些默认配置","aria-hidden":"true"}},[e._v("#")]),e._v(" 第五步，关掉一些默认配置")]),e._v(" "),r("pre",[r("code",[e._v("sudo update-rc.d fake-hwclock disable\nsudo update-rc.d ntp disable\n")])]),e._v(" "),r("p",[e._v("然后再重启下：")]),e._v(" "),r("pre",[r("code",[e._v("sudo reboot\n")])]),e._v(" "),r("h3",{attrs:{id:"第六步，配置正确时间，并写入到rtc模块中"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第六步，配置正确时间，并写入到rtc模块中","aria-hidden":"true"}},[e._v("#")]),e._v(" 第六步，配置正确时间，并写入到rtc模块中")]),e._v(" "),r("p",[e._v("可以用命令："),r("code",[e._v('sudo date -s "2013-09-30 10:10:10"')]),e._v("来设置本地系统时间，然后需要再用命令：")]),e._v(" "),r("pre",[r("code",[e._v("sudo hwclock -w\n")])]),e._v(" "),r("p",[e._v("将系统时间写入到RTC模块。另外，下面还有几个命令：")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("改RTC模块的时间")]),e._v(" "),r("p",[e._v("sudo hwclock --set  --date 05:05:05\nsudo hwclock --set  --date 2013-09-30")])]),e._v(" "),r("li",[r("p",[e._v("把rtc模块的时间更新到系统时间")]),e._v(" "),r("p",[e._v("sudo hwclock –s")])])]),e._v(" "),r("p",[e._v("最后，可以验证下，关机，重插电源 ，然后开机试试看。")])])},[],!1,null,null,null);t.default=d.exports}}]);